---
layout: default
title: Regression
level: detail
description: Learn about regression methods such as ridge regression and Lasso regression.
uses_math: true
uses_python: false
---
<!DOCTYPE html>
<html>
    <body> 
        <div class="hero-section">
            <h1 class="webpage-name">Regression
            </h1>
        </div>

        <div class="topic-nav">
            <a href="#ridge">Ridge Regression</a></li>
            <a href="#lasso">Lasso Regression</a>
            <a href="#Demo">Demo: Ridge Regression</a>
            <a href="#CV">Cross Validation</a>
            <a href="#b-v">Bias-Variance Tradeoff in Ridge Regression</a>
        </div> 

        <div class="container">  
            <section id="ridge" class="section-content">
                <h2>Ridge Regression</h2>
                <p>
                    Let's first review <a href="../Probability/linear_regression.html"><strong>linear regression</strong></a>. 
                    Suppose we are given observed data points \({\{(x_i, y_i)\}_{i = 1}^n}\), where each \(x_i \in \mathbb{R}^d\) is a 
                    feature vector, and \(y_i \in \mathbb{R}\) is the corresponding target value. The linear regression model assumes a 
                    linear relationship:
                    \[
                    y = Xw + \epsilon, 
                    \]
                    where \(X \in \mathbb{R}^{n \times d}\) is the design matrix, \(w \in \mathbb{R}^d\) is the weight vector to be estimated, 
                    and \(\epsilon \sim \mathcal{N}(0, \sigma^2 I)\) is a Gaussian noise vector.
                </p>
                   
                <p>
                    In linear regression, the <a href="../Probability/mle.html"><strong>maximum likelihood estimator (MLE)</strong></a> 
                    of \(w\) coincides with the <a href="../Linear_algebra/leastsquares.html"><strong>least-squares solution</strong></a>: 
                    \[
                    \begin{align*}
                    \widehat{w}_{LS}    &= \arg \min_w \sum_{i=1}^n (y_i - {x_i}^\top w)^2 \\\\
                                        &= \arg \min_w \|y - Xw\|_2^2 \\\\
                                        &= \arg \min_w (y - Xw)^\top (y - Xw) \\\\
                                        &= \arg \min_w y^\top y -y^\top Xw - w^T X^T y + w^\top X^\top X w\\\\
                                        &= \arg \min_w f(w) \\\\
                    \end{align*}
                    \]
                    
                    Differentiating with respect to \(w\) and setting the gradient to zero:
                    \[
                    \begin{align*}
                        \nabla f(w) &= -X^\top y -X^\top y + 2X^\top Xw \\\\
                                    &= -2X^\top y + 2 X^\top X w  = 0 
                    \end{align*}
                    \]
                    Thus, if \((X^\top X)^{-1}\) exists,
                    \[
                    \begin{align*}
                    \widehat{w}_{LS} &= (X^\top X)^{-1}X^\top y \\\\
                                     &= \widehat{w}_{MLE}.
                    \end{align*}
                    \]
                </p>

                <p>
                    However, when \(d \gg n\), the matrix \(X^T X\) becomes ill-conditioned or singular. This leads to a flat objective 
                    surface in some directions, making the solution non-unique and highly sensitive to noise — a phenomenon known as 
                    <strong>overfitting</strong>.
                </p>

                <p>     
                    To mitigate this issue, we add a penalty term on the objective. This technique is called <strong>regularization</strong>, 
                    and the modified version of linear regression is known as <strong>ridge regression</strong>:
                    \[
                    \begin{align*}
                    \widehat{w}_{ridge} &= \arg \min_w \sum_{i=1}^n (y_i - {x_i}^\top w)^2 +  \lambda \|w\|_2^2.\\\\
                                        &=  \arg \min_w \|y - Xw\|_2^2 + \lambda w^\top w\\\\
                                        &= \arg \min_w (Xw -y)^\top (Xw-y)+\lambda w^\top w \\\\
                                        &= \arg \min_w y^\top y -2w^\top Xy +w^\top X^\top Xw + w^\top (\lambda I)w \\\\
                                        &= \arg \min_w y^\top y -2w^\top Xy +w^\top  (X^\top X + \lambda I)w \\\
                                        &= \arg \min_w J(W)            
                    \end{align*}
                    \]
                    Then
                    \[
                    \nabla_w J(w) = -2X^\top y +2(X^\top X + \lambda I )w = 0
                    \]
                    Solve this equation for \(w\), we botain 
                    \[
                    \widehat{w}_{ridge} = (X^\top X + \lambda I)^{-1}X^\top y.
                    \]
                </p>

                <p>
                    The hyperparameter \(\lambda \geq 0\) controls the strength of the regularization:
                    <ul style="padding-left: 40px;">
                        <li>As \(\lambda \to 0\), the solution approaches the least-squares solution: \(\widehat{w}_{ridge} \to \widehat{w}_{LS}\).</li>
                        <li>As \(\lambda \to \infty\), the solution is pushed toward zero: \(\widehat{w}_{ridge} \to 0\), leading to high bias but low variance.</li>
                    </ul>
                    <br>
                    This illustrates the classic <strong>bias-variance tradeoff</strong> in statistical learning. 
                </p>

            </section>

            <section id="Demo" class="section-content">
              
                
                <h2>Demo: Ridge Regression</h2>
                <div id="ridge_regression_visualizer"></div>
                <p>
                    Note: Tiny regularization \(\lambda = 0.0001\) has been added on linear regression for numerical stability.
                </p>

                <p> 
                    After running the demo above, we observe that linear regression tends to achieve lower training error but at the cost of higher test error and wildly large 
                    coefficients, especially with high polynomial degrees. This means the model memorizes the training data too closely and fails to generalize 
                    well to new, unseen data. 
                </p>
                <p>
                    In contrast, ridge regression, by constraining the weights, may have slightly higher training error but typically generalizes 
                    better to new data. This trade-off between fitting the training data and maintaining model simplicity is known as the <strong>bias-variance tradeoff</strong>. 
                    Increasing the model complexity (e.g., by raising the polynomial degree) monotonically reduces training error, but <strong>after a certain point, the test error begins to increase.</strong>
                    This turning point highlights the danger of <strong>overfitting</strong>.
                </p>
            </section>

            <section id="CV" class="section-content">
                <h2>Cross Validation</h2>
                <p>
                    To build a <strong>generalized</strong> model and select an appropriate <strong>regularization</strong> strength (\(\lambda\)), 
                    we employ <strong>K-fold cross-validation (CV)</strong> on the <strong>training set</strong>. The training data is partitioned into \(K\) 
                    equal-sized folds. For each fold \(k \in \{1, \cdots, K\}\), the model is trained on the \(K - 1\) other folds and validated on the \(k\)th fold. 
                    This process is repeated \(K\) times, ensuring that each data point in the training set is used once for validation. The average validation 
                    error is used to select the optimal hyperparameter \(\lambda\). Finally, the model is evaluated on the <strong>held-out test set</strong>.
                </p>

                <p>
                    Here, we demonstrate how k-fold CV is used to tune the regularization parameter \(\lambda\) in Ridge Regression.
                </p>
               
                <p>
                    An special case of K-fold CV is <strong>Leave-One-Out Cross-Validation (LOOCV)</strong>, where the number of folds \(K\) equals the 
                    number of data points in the training set. That is, the model is trained on all training data points except one, which is used for validation, 
                    and this process is repeated for each data point. Thus, LOOCV tends to produce a low-bias estimate of the validation error. However, 
                    LOOCV is computationally expensive for large datasets. In contrast, smaller values of \(K\) (like 5 ~ 10) offer a good tradeoff between bias, 
                    variance, and computational cost, making them a popular choice in practice.
                </p>

                <div id="cross_validation_visualizer"></div>

            </section>

            <section id="b-v" class="section-content">
                <h2>Bias-Variance Tradeoff in Ridge Regression</h2>
                <p>
                    Let's dive into a formal derivation of expected prediction error in the context of ridge regression. Remember we have 
                    obtained: 
                    \[
                    \widehat{w}_{ridge} = (X^\top X + \lambda I)^{-1}X^\top y.
                    \]
                    We assume probabilistic generative model:
                    \[
                    x_i \sim P_X, \quad y = Xw + \epsilon, \text{ where } \epsilon \sim \mathcal{N}(0, \sigma^2 I).
                    \]
                    The true error at a sample with feature \(x\) is given by: 
                    \[
                    \begin{align*}
                    &\mathbb{E}_{y, D  \mid x} \left[ \left(y - x^\top \widehat{w}_{\text{ridge}} \right)^2 \mid x \right] \\\\

                    &= \mathbb{E}_{y \mid x} \left[ \left(y - \mathbb{E}[y \mid x] \right)^2 \mid  x \right]
                        + \mathbb{E}_D \left[ \left( \mathbb{E}[y \mid  x]  -x^\top \widehat{w}_{ridge} \right)^2  \mid x  \right] \\\\

                    &= \underbrace{ \mathbb{E}_{y \mid x} \left[ \left(y - x^\top w \right)^2 \mid x \right] }_{\text{Irreducible error}}
                        + \mathbb{E}_D \left[ \left(x^\top w - x^\top \widehat{w}_{ridge} \right)^2 \mid x \right] \\\\

                    &= \sigma^2 
                        + \underbrace{\left(x^\top w - \mathbb{E}_D \left[x^\top  \widehat{w}_{ridge} \mid x \right] \right)^2  }_{(\text{Bias})^2} 
                        + \underbrace{ \mathbb{E}_D \left[ \left( x^\top \widehat{w}_{ridge} - \mathbb{E}_D \left[  x^\top \widehat{w}_{ridge} \mid x\right] \right)^2 \mid x \right] }_{\text{Variance}} \\\\
                      \end{align*}
                    \]
                    Here, we assume \(X^\top X = n I\), then 
                    \[
                    \begin{align*}
                     \widehat{w}_{ridge} &= (X^\top X + \lambda I)^{-1} X^\top (Xw + \epsilon) \\\\
                                         &= (nI + \lambda I)^{-1}(nIw + X^\top \epsilon) \\\\
                                         &= (n + \lambda)^{-1} I (nw + X^\top \epsilon) \\\\
                                         &= \frac{n}{n + \lambda}w + \frac{1}{n + \lambda} X^\top \epsilon
                    \end{align*}
                    \]
                    Also, 
                    \[
                    x^\top \widehat{w}_{ridge} = \frac{n}{n + \lambda}x^\top w + \frac{1}{n + \lambda} (Xx)^\top \epsilon.
                    \]
                    Since \(\mathbb{E}[\epsilon] = 0\), the bias term is written as: 
                    \[
                    \begin{align*}
                    &(\text{Bias})^2  \\\\
                    &= \left( x^\top w -\mathbb{E}_D \left[x^\top \widehat{w}_{ridge}\right] \right)^2 \\\\
                    &= \left( x^\top w -\mathbb{E}_D \left[\frac{n}{n + \lambda}x^\top w + \frac{1}{n + \lambda} (Xx)^\top \epsilon \right] \right)^2 \\\\
                    &= \left( x^\top w - \frac{n}{n + \lambda}x^\top w  \right)^2 \\\\
                    &= \frac{\lambda^2}{(n + \lambda)^2}(x^\top w)^2 
                    \end{align*} 
                    \]
                    For the variance term, since the variance of a constant is always zero,
                    \[
                    \begin{align*}
                    &\text{Variance} \\\\
                    &= \text{Var}\left[ x^\top \widehat{w}_{ridge}\right] \\\\
                    &= \text{Var}\left[ \frac{1}{n + \lambda} (Xx)^\top \epsilon \right] \\\\
                    &= \frac{1}{(n + \lambda)^2}\text{Var}\left[(Xx)^\top \epsilon \right] \\\\
                    &= \frac{1}{(n + \lambda)^2} \sigma^2 x^\top (X^\top X) x \\\\
                    &= \frac{1}{(n + \lambda)^2} x^\top \sigma^2 n I x \\\\
                    &= \frac{\sigma^2 n}{(n + \lambda)^2} \| x \|_2^2 \\\\
                    \end{align*} 
                    \]

                    Therefore, 
                    \[
                    \begin{align*}
                        &\mathbb{E}_{y, D  \mid x} \left[ \left(y - x^\top \widehat{w}_{\text{ridge}} \right)^2 \mid x \right] \\\\
                        &= \sigma^2 + \frac{\lambda^2}{(n + \lambda)^2}(w^\top x)^2 + \frac{\sigma^2 n}{(n + \lambda)^2} \| x \|_2^2
                    \end{align*}
                    \]
                </p>
            </section>

            <section id="LASSO" class="section-content">
                <h2>Lasso Regression</h2>
                    <p>
                    Recall the ridge solution:
                    \[
                    \widehat w_{\text{ridge}} = (X^\top X + \lambda I)^{-1}X^\top y,
                    \quad y = Xw + \epsilon,\;\epsilon\sim\mathcal{N}(0,\sigma^2I).
                    \]
                    We measure the expected squared prediction error at a new feature vector \(x\):
                    \[
                    \mathbb{E}_{y,D}\bigl[(y - x^\top\widehat w_{\text{ridge}})^2 \mid x\bigr].
                    \]
                    First decompose into irreducible noise plus squared-error around the conditional mean:
                    \[
                    \begin{aligned}
                    &\mathbb{E}_{y,D}\bigl[(y - x^\top\widehat w)^2\mid x\bigr]\\[6pt]
                    &= \mathbb{E}_{D}\Bigl[\underbrace{\mathbb{E}_{y\mid x}\bigl[(y - x^\top\widehat w)^2\bigr]}_{\substack{\sigma^2\\\text{(noise)}}}\Bigr]
                        = \sigma^2 + \mathbb{E}_{D}\Bigl[\bigl(x^\top w - x^\top\widehat w\bigr)^2\Bigr].
                    \end{aligned}
                    \]
                    Next split that remaining term into bias² + variance:
                    \[
                    \begin{aligned}
                    &\mathbb{E}_{D}\bigl[(x^\top w - x^\top\widehat w)^2\bigr]\\[4pt]
                    &= \underbrace{\bigl(x^\top w - \mathbb{E}_{D}[x^\top\widehat w]\bigr)^2}_{\text{Bias}^2}
                    + \underbrace{\mathbb{E}_{D}\bigl[\bigl(x^\top\widehat w - \mathbb{E}_{D}[x^\top\widehat w]\bigr)^2\bigr]}_{\text{Variance}}.
                    \end{aligned}
                    \]
                </p>

                <p>
                    Now assume \(X^\top X = nI\).  Then
                    \[
                    \begin{aligned}
                    \widehat w_{\text{ridge}}
                    &= (X^\top X + \lambda I)^{-1}X^\top(Xw + \epsilon)\\[4pt]
                    &= (nI + \lambda I)^{-1}\bigl(nIw + X^\top\epsilon\bigr)\\[4pt]
                    &= (n+\lambda)^{-1}I\,(n\,w + X^\top\epsilon)\\[4pt]
                    &= \frac{n}{n+\lambda}w \;+\; \frac{1}{n+\lambda}X^\top\epsilon.
                    \end{aligned}
                    \]
                    Therefore
                    \[
                    x^\top\widehat w_{\text{ridge}}
                    = \frac{n}{n+\lambda}\,x^\top w
                    \;+\;\frac{1}{n+\lambda}\,(Xx)^\top\epsilon.
                    \]
                </p>

                <p><strong>Bias term:</strong></p>
                \[
                \begin{aligned}
                    \mathbb{E}_{D}[\,x^\top\widehat w\,]
                    &= \frac{n}{n+\lambda}\,x^\top w
                    + \frac{1}{n+\lambda}\,\mathbb{E}[(Xx)^\top\epsilon]\\[4pt]
                    &= \frac{n}{n+\lambda}\,x^\top w
                    \quad(\text{since }\mathbb{E}[\epsilon]=0),\\[6pt]
                    \text{Bias}^2
                    &= \bigl(x^\top w - \mathbb{E}_{D}[x^\top\widehat w]\bigr)^2
                    = \Bigl(x^\top w - \tfrac{n}{n+\lambda}x^\top w\Bigr)^2
                    = \frac{\lambda^2}{(n+\lambda)^2}\,(x^\top w)^2.
                \end{aligned}
                \]

                <p><strong>Variance term:</strong></p>
                \[
                \begin{aligned}
                    \mathrm{Var}_{D}[\,x^\top\widehat w\,]
                    &= \mathrm{Var}\Bigl[\tfrac{1}{n+\lambda}(Xx)^\top\epsilon\Bigr]\\[4pt]
                    &= \frac{1}{(n+\lambda)^2}\,\mathrm{Var}\bigl[(Xx)^\top\epsilon\bigr]\\[4pt]
                    &= \frac{1}{(n+\lambda)^2}\,(Xx)^\top(\sigma^2I)(Xx)\\[4pt]
                    &= \frac{\sigma^2}{(n+\lambda)^2}\,x^\top(X^\top X)\,x
                    = \frac{\sigma^2\,n}{(n+\lambda)^2}\,\|x\|_2^2.
                \end{aligned}
                \]

                <p><strong>Putting it all together:</strong></p>
                \[
                    \mathbb{E}_{y,D}[(y - x^\top\widehat w_{\text{ridge}})^2\mid x]
                    = \sigma^2
                    + \frac{\lambda^2}{(n+\lambda)^2}\,(x^\top w)^2
                    + \frac{\sigma^2\,n}{(n+\lambda)^2}\,\|x\|_2^2.
                \]
            </section>

    

        
            
        </div>
        <script src="/js/main.js"></script> 
        <script src="/js/ridge_regression.js"></script>
        <script src="/js/cross_validation.js"></script>
    </body>
</html>