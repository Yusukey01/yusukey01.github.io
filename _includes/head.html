<head>
    <!-- ============================================
         1. CRITICAL META TAGS (must be first)
         ============================================ -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- ============================================
         2. TITLE
         ============================================ -->
    <title>{% if page.title %}{{ page.title }} - MATH-CS COMPASS{% else %}MATH-CS COMPASS - Bridging Pure & Applied Mathematics{% endif %}</title>
    
    <!-- ============================================
         3. PRECONNECT / DNS-PREFETCH (for performance)
         ============================================ -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    
    <!-- ============================================
         4. STYLESHEETS
         ============================================ -->
    {% assign css_prefix = '' %}
    {% if page.level == 'section' %}{% assign css_prefix = '../../' %}
    {% elsif page.level != 'home' %}{% assign css_prefix = '../../../' %}{% endif %}
    
    <link rel="stylesheet" href="{{ css_prefix }}css/styles.css?v={{ site.version }}">
    <link rel="stylesheet" href="{{ css_prefix }}css/dark-theme-enhancement.css?v={{ site.version }}">
    <link rel="stylesheet" href="{{ css_prefix }}css/compass-map-styles.css?v={{ site.version }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- ============================================
         5. SEO META TAGS
         ============================================ -->
    <meta name="description" content="{{ page.description | default: site.description }}">
    <link rel="canonical" href="https://math-cs-compass.com{{ page.url }}">
    
    {% if page.noindex %}
    <meta name="robots" content="noindex">
    {% endif %}
    
    <!-- Google Search Console Verification -->
    <meta name="google-site-verification" content="IieEujypYW38caEVe8ymjczouNl56yxAy27iPztcfRA">
    
    <!-- ============================================
         6. OPEN GRAPH / SOCIAL META TAGS
         ============================================ -->
    <meta property="og:title" content="{% if page.title %}{{ page.title }} - MATH-CS COMPASS{% else %}MATH-CS COMPASS - Bridging Pure & Applied Mathematics{% endif %}">
    <meta property="og:description" content="{{ page.description | default: site.description }}">
    <meta property="og:url" content="https://math-cs-compass.com{{ page.url }}">
    <meta property="og:type" content="{% if page.level == 'home' %}website{% else %}article{% endif %}">
    <meta property="og:site_name" content="MATH-CS COMPASS">
    <meta property="og:image" content="https://math-cs-compass.com/images/og-image.png">
    
    <!-- Twitter Card (optional, falls back to OG) -->
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- ============================================
         7. ICONS & PWA MANIFEST
         ============================================ -->
    <!-- Favicon: Modern browsers -->
    <link rel="icon" href="/favicon.ico" sizes="32x32">
    <link rel="icon" href="/images/icon.svg" type="image/svg+xml">
    
    <!-- Apple Touch Icon: Single 180x180 is sufficient (iOS auto-scales) -->
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MATH-CS COMPASS">
    
    <!-- ============================================
         8. STRUCTURED DATA (Schema.org)
         ============================================ -->
    {% if page.level == 'home' %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "MATH-CS COMPASS",
      "description": "Bridging Pure & Applied Mathematics with Computer Science and Machine Learning",
      "url": "https://math-cs-compass.com",
      "author": {
        "@type": "Person",
        "name": "Yusuke Yokota",
        "jobTitle": "Mathematics & Computer Science Educator",
        "alumniOf": {
          "@type": "EducationalOrganization",
          "name": "Western Washington University"
        },
        "sameAs": [
          "https://github.com/Yusukey01",
          "https://www.facebook.com/share/15uPaBWgQN/"
        ]
      },
      "publisher": {
        "@type": "Organization",
        "name": "MATH-CS COMPASS",
        "url": "https://math-cs-compass.com",
        "logo": {
          "@type": "ImageObject",
          "url": "https://math-cs-compass.com/images/icon-512.png"
        }
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://math-cs-compass.com/?search={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    {% elsif page.title %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "{{ page.title }}",
      "description": "{{ page.description | default: site.description }}",
      "datePublished": "{{ page.date | default: '2024-01-01' | date: '%Y-%m-%d' }}",
      "dateModified": "{{ page.last_modified | default: site.time | date: '%Y-%m-%d' }}",
      "author": {
        "@type": "Person",
        "name": "Yusuke Yokota"
      },
      "publisher": {
        "@type": "Organization",
        "name": "MATH-CS COMPASS",
        "logo": {
          "@type": "ImageObject",
          "url": "https://math-cs-compass.com/images/icon-512.png"
        }
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://math-cs-compass.com{{ page.url }}"
      },
      "educationalLevel": "university",
      "learningResourceType": "tutorial"
    }
    </script>
    {% endif %}
    
    <!-- ============================================
         9. MATHJAX (Conditional)
         ============================================ -->
    {% if page.uses_math or layout.uses_math %}
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      chtml: {
        fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
      }
    };
    </script>
    <script id="MathJax-script" async 
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    {% endif %}
    
    <!-- ============================================
         10. PYODIDE (Conditional)
         ============================================ -->
    {% if page.uses_python or layout.uses_python %}
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.3/full/pyodide.js" defer></script>
    {% endif %}
    
    <!-- ============================================
         11. GOOGLE ADSENSE (load last, async)
         ============================================ -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5188353244584823"
            crossorigin="anonymous"></script>
    
    <!-- ============================================
         12. PAGE INITIALIZATION SCRIPT
         ============================================ -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var path = window.location.pathname;
        var section = '';
        if (path.includes('Linear_algebra')) section = 'I';
        else if (path.includes('Calculus')) section = 'II';
        else if (path.includes('Probability')) section = 'III';
        else if (path.includes('Discrete')) section = 'IV';
        else if (path.includes('Machine_learning')) section = 'V';
        if (section) document.body.setAttribute('data-section', section);
      });
    </script>
</head>