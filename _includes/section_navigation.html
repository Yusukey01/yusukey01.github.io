{% comment %}
  Unified Section Navigation - Single source from curriculum.json
{% endcomment %}

{% assign curriculum = site.data.curriculum %}
{% assign sections = curriculum.sections %}

{% comment %} Create a lowercase version of the URL for robust matching {% endcomment %}
{% assign url_lower = page.url | downcase %}

{% comment %} Determine current section based on URL (checking lowercase) {% endcomment %}
{% if url_lower contains 'linear_algebra' %}
  {% assign current_section = sections["I"] %}
  {% assign section_key = "I" %}
  {% assign overview_file = "linear_algebra.html" %}
{% elsif url_lower contains 'calculus' %}
  {% assign current_section = sections["II"] %}
  {% assign section_key = "II" %}
  {% assign overview_file = "calculus.html" %}
{% elsif url_lower contains 'probability' %}
  {% assign current_section = sections["III"] %}
  {% assign section_key = "III" %}
  {% assign overview_file = "probability.html" %}
{% elsif url_lower contains 'discrete' %}
  {% assign current_section = sections["IV"] %}
  {% assign section_key = "IV" %}
  {% assign overview_file = "discrete_math.html" %}
{% elsif url_lower contains 'machine_learning' %}
  {% assign current_section = sections["V"] %}
  {% assign section_key = "V" %}
  {% assign overview_file = "ml.html" %}
{% endif %}

{% if current_section %}
<div class="quick-jump-container">
    <button type="button" id="quick-jump-toggle" class="quick-jump-toggle">
      <i class="fas fa-list"></i> <strong>Section {{ section_key }} Navigation</strong>
    </button>
    <div id="quick-jump-menu" class="quick-jump-menu">
      <h3>{{ current_section.title }}</h3>
      <div class="quick-jump-links">

        {% if page.level == 'detail' %}
        <a href="{{ overview_file }}">‚Üê Back to Section {{ section_key }} Overview</a>
        <hr style="margin: 8px 0; border: 1px solid #ddd;">
        {% endif %}
        
        {% for part in current_section.parts %}
          {% comment %} Build the URL based on whether we're at detail level or overview {% endcomment %}
          {% if page.level == 'detail' %}
            {% assign part_url = part.url %}
          {% else %}
            {% comment %} For overview pages, construct relative path {% endcomment %}
            {% assign base_parts = current_section.baseUrl | split: "/" %}
            {% assign folder_name = base_parts[1] %}
            {% assign part_url = "../" | append: folder_name | append: "/" | append: part.url %}
          {% endif %}
          
          {% comment %} Check if this is the current page {% endcomment %}
          {% assign url_without_ext = part.url | remove: ".html" %}
          {% if page.url contains url_without_ext %}
            {% assign is_current = true %}
          {% else %}
            {% assign is_current = false %}
          {% endif %}
          
          <a href="{{ part_url }}" {% if is_current %}class="current-page"{% endif %}>Part {{ part.part }}: {{ part.title }}</a>
        {% endfor %}
            
      </div>
    </div>
</div>
{% endif %}