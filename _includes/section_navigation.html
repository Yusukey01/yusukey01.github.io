{% comment %}
  Unified Section Navigation - Single source from curriculum.json
{% endcomment %}

{% assign curriculum = site.data.curriculum %}

{% comment %} Determine current section based on URL {% endcomment %}
{% assign current_section = nil %}
{% assign section_key = nil %}
{% assign overview_file = nil %}

{% if page.url contains 'Linear_algebra' %}
  {% assign section_key = "I" %}
  {% assign overview_file = "linear_algebra.html" %}
{% elsif page.url contains 'Calculus' %}
  {% assign section_key = "II" %}
  {% assign overview_file = "calculus.html" %}
{% elsif page.url contains 'Probability' %}
  {% assign section_key = "III" %}
  {% assign overview_file = "probability.html" %}
{% elsif page.url contains 'Discrete' %}
  {% assign section_key = "IV" %}
  {% assign overview_file = "discrete_math.html" %}
{% elsif page.url contains 'Machine_learning' %}
  {% assign section_key = "V" %}
  {% assign overview_file = "ml.html" %}
{% endif %}

{% comment %} Find the matching section by iterating through all sections {% endcomment %}
{% if section_key %}
  {% for section_entry in curriculum.sections %}
    {% if section_entry[0] == section_key %}
      {% assign current_section = section_entry[1] %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

{% if current_section %}
<div class="quick-jump-container">
    <button type="button" id="quick-jump-toggle" class="quick-jump-toggle">
      <i class="fas fa-list"></i> <strong>Section {{ section_key }} Navigation</strong>
    </button>
    <div id="quick-jump-menu" class="quick-jump-menu">
      <h3>{{ current_section.title }}</h3>
      <div class="quick-jump-links">

        {% if page.level == 'detail' %}
        <a href="{{ overview_file }}">‚Üê Back to Section {{ section_key }} Overview</a>
        <hr style="margin: 8px 0; border: 1px solid #ddd;">
        {% endif %}
        
        {% for part in current_section.parts %}
          {% if page.level == 'detail' %}
            {% assign part_url = part.url %}
          {% else %}
            {% assign base_parts = current_section.baseUrl | split: "/" %}
            {% assign folder_name = base_parts[1] %}
            {% assign part_url = "../" | append: folder_name | append: "/" | append: part.url %}
          {% endif %}
          
          {% assign url_without_ext = part.url | remove: ".html" %}
          {% if page.url contains url_without_ext %}
            {% assign is_current = true %}
          {% else %}
            {% assign is_current = false %}
          {% endif %}
          
          <a href="{{ part_url }}" {% if is_current %}class="current-page"{% endif %}>Part {{ part.part }}: {{ part.title }}</a>
        {% endfor %}
            
      </div>
    </div>
</div>
{% endif %}