{% comment %}
  DEBUG VERSION - Section Navigation
{% endcomment %}

{% assign curriculum = site.data.curriculum %}

<!-- DEBUG: Check if curriculum loaded -->
<div style="background: yellow; padding: 10px; margin: 10px 0; border: 2px solid red;">
  <strong>DEBUG INFO:</strong><br>
  
  <!-- Check if curriculum exists -->
  {% if curriculum %}
    ✅ curriculum loaded<br>
  {% else %}
    ❌ curriculum is NULL<br>
  {% endif %}
  
  <!-- Check if sections exists -->
  {% if curriculum.sections %}
    ✅ curriculum.sections exists<br>
  {% else %}
    ❌ curriculum.sections is NULL<br>
  {% endif %}
  
  <!-- Check page.url -->
  page.url = "{{ page.url }}"<br>
  
  <!-- Check page.level -->
  page.level = "{{ page.level }}"<br>
  
  <!-- Check what sections are available -->
  {% if curriculum.sections %}
    <br>Available section keys:<br>
    {% for section_entry in curriculum.sections %}
      - Key: "{{ section_entry[0] }}" | Title: "{{ section_entry[1].title }}"<br>
    {% endfor %}
  {% endif %}
  
  <!-- Test direct access -->
  <br>Testing URL matching:<br>
  {% if page.url contains 'Linear_algebra' %}
    ✅ URL contains 'Linear_algebra'<br>
  {% else %}
    ❌ URL does NOT contain 'Linear_algebra'<br>
  {% endif %}
  
  {% if page.url contains 'linear_algebra' %}
    ✅ URL contains 'linear_algebra' (lowercase)<br>
  {% else %}
    ❌ URL does NOT contain 'linear_algebra' (lowercase)<br>
  {% endif %}
</div>

{% comment %} Original navigation code below {% endcomment %}

{% assign current_section = nil %}
{% assign section_key = nil %}
{% assign overview_file = nil %}

{% if page.url contains 'Linear_algebra' %}
  {% assign section_key = "I" %}
  {% assign overview_file = "linear_algebra.html" %}
{% elsif page.url contains 'Calculus' %}
  {% assign section_key = "II" %}
  {% assign overview_file = "calculus.html" %}
{% elsif page.url contains 'Probability' %}
  {% assign section_key = "III" %}
  {% assign overview_file = "probability.html" %}
{% elsif page.url contains 'Discrete' %}
  {% assign section_key = "IV" %}
  {% assign overview_file = "discrete_math.html" %}
{% elsif page.url contains 'Machine_learning' %}
  {% assign section_key = "V" %}
  {% assign overview_file = "ml.html" %}
{% endif %}

<!-- DEBUG: After URL check -->
<div style="background: lightblue; padding: 10px; margin: 10px 0;">
  section_key = "{{ section_key }}"<br>
  overview_file = "{{ overview_file }}"
</div>

{% if section_key %}
  {% for section_entry in curriculum.sections %}
    {% if section_entry[0] == section_key %}
      {% assign current_section = section_entry[1] %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endif %}

<!-- DEBUG: After section lookup -->
<div style="background: lightgreen; padding: 10px; margin: 10px 0;">
  {% if current_section %}
    ✅ current_section found: "{{ current_section.title }}"<br>
    Parts count: {{ current_section.parts.size }}
  {% else %}
    ❌ current_section is NULL
  {% endif %}
</div>

{% if current_section %}
<div class="quick-jump-container">
    <button type="button" id="quick-jump-toggle" class="quick-jump-toggle">
      <i class="fas fa-list"></i> <strong>Section {{ section_key }} Navigation</strong>
    </button>
    <div id="quick-jump-menu" class="quick-jump-menu">
      <h3>{{ current_section.title }}</h3>
      <div class="quick-jump-links">

        {% if page.level == 'detail' %}
        <a href="{{ overview_file }}">← Back to Section {{ section_key }} Overview</a>
        <hr style="margin: 8px 0; border: 1px solid #ddd;">
        {% endif %}
        
        {% for part in current_section.parts %}
          {% if page.level == 'detail' %}
            {% assign part_url = part.url %}
          {% else %}
            {% assign base_parts = current_section.baseUrl | split: "/" %}
            {% assign folder_name = base_parts[1] %}
            {% assign part_url = "../" | append: folder_name | append: "/" | append: part.url %}
          {% endif %}
          
          {% assign url_without_ext = part.url | remove: ".html" %}
          {% if page.url contains url_without_ext %}
            {% assign is_current = true %}
          {% else %}
            {% assign is_current = false %}
          {% endif %}
          
          <a href="{{ part_url }}" {% if is_current %}class="current-page"{% endif %}>Part {{ part.part }}: {{ part.title }}</a>
        {% endfor %}
            
      </div>
    </div>
</div>
{% endif %}