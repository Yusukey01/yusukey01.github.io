{% comment %}
  Section Navigation - Loads curriculum.json via JavaScript
  (Because data files are in /data/ not /_data/)
{% endcomment %}

<div class="quick-jump-container">
    <button type="button" id="quick-jump-toggle" class="quick-jump-toggle">
      <i class="fas fa-list"></i> <strong id="nav-section-title">Section Navigation</strong>
    </button>
    <div id="quick-jump-menu" class="quick-jump-menu">
      <h3 id="nav-section-heading">Loading...</h3>
      <div class="quick-jump-links" id="nav-links-container">
        <!-- Links will be populated by JavaScript -->
      </div>
    </div>
</div>

<script>
(function() {
  // Determine current section from URL
  const path = window.location.pathname;
  let sectionKey = null;
  let overviewFile = null;
  
  if (path.includes('Linear_algebra')) {
    sectionKey = 'I';
    overviewFile = 'linear_algebra.html';
  } else if (path.includes('Calculus')) {
    sectionKey = 'II';
    overviewFile = 'calculus.html';
  } else if (path.includes('Probability')) {
    sectionKey = 'III';
    overviewFile = 'probability.html';
  } else if (path.includes('Discrete')) {
    sectionKey = 'IV';
    overviewFile = 'discrete_math.html';
  } else if (path.includes('Machine_learning')) {
    sectionKey = 'V';
    overviewFile = 'ml.html';
  }
  
  if (!sectionKey) {
    // Not in a section page, hide navigation
    document.querySelector('.quick-jump-container').style.display = 'none';
    return;
  }
  
  // Check if this is a detail page (has level: detail in front matter)
  const isDetailPage = '{{ page.level }}' === 'detail';
  
  // Load curriculum data
  fetch('/data/curriculum.json')
    .then(response => response.json())
    .then(curriculum => {
      const section = curriculum.sections[sectionKey];
      if (!section) {
        console.error('Section not found:', sectionKey);
        return;
      }
      
      // Update section title
      document.getElementById('nav-section-title').innerHTML = 
        'Section ' + sectionKey + ' Navigation';
      document.getElementById('nav-section-heading').textContent = section.title;
      
      // Build navigation links
      const container = document.getElementById('nav-links-container');
      let html = '';
      
      // Add back link for detail pages
      if (isDetailPage) {
        html += '<a href="' + overviewFile + '">‚Üê Back to Section ' + sectionKey + ' Overview</a>';
        html += '<hr style="margin: 8px 0; border: 1px solid #ddd;">';
      }
      
      // Add part links
      section.parts.forEach(part => {
        let partUrl;
        if (isDetailPage) {
          partUrl = part.url;
        } else {
          // For overview pages, construct relative path
          const folderName = section.baseUrl.split('/')[1];
          partUrl = '../' + folderName + '/' + part.url;
        }
        
        // Check if current page
        const urlWithoutExt = part.url.replace('.html', '');
        const isCurrent = path.includes(urlWithoutExt);
        
        html += '<a href="' + partUrl + '"' + (isCurrent ? ' class="current-page"' : '') + '>';
        html += 'Part ' + part.part + ': ' + part.title;
        html += '</a>';
      });
      
      container.innerHTML = html;
    })
    .catch(error => {
      console.error('Failed to load curriculum:', error);
      document.querySelector('.quick-jump-container').style.display = 'none';
    });
})();
</script>